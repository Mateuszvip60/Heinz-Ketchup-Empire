<!DOCTYPE html>
<html lang="pl">
<head>
<script type="text/javascript">
  // This is a CodeSandbox injection script that's used to
  // add navigation and inspector functionality to the preview
  (function () {
    // 1) Get the <script> tag that's currently running:
    var me = document.currentScript;

    // 2) Create the blocking‚Äêstyle <script> to load:
    var script = document.createElement("script");
    script.src = "https://codesandbox.io/p/preview-protocol.js";

    // By default a dynamically‚Äêinserted <script> is async=true.
    // Turn async off to make it behave like a normal blocking <script>:
    script.async = false;
    // (Do NOT set defer.)

    // 3) Insert it immediately after the current <script>:
    me.parentNode.insertBefore(script, me);
  })();

  const isIFramePreview = window.top !== window.self;

  // Only run this script in editor context
  if (isIFramePreview) {
    // This script is used to enable Chrome DevTools functionality
    (function () {
      var script = document.createElement("script");
      script.src =
        "https://codesandbox.io/p/chrome-devtool/protocol/index.js";

      script.onload = () => {
        const devtoolProtocol = window.chobitsu;
        if (devtoolProtocol) {
          window.addEventListener("message", (event) => {
            const { type, data } = event.data;

            if (type === "FROM_DEVTOOL") {
              devtoolProtocol.sendRawMessage(data);
            }
          });

          devtoolProtocol.setOnMessage((data) => {
            if (data.includes('"id":"tmp')) {
              return;
            }

            window.parent.postMessage({ type: "TO_DEVTOOL", data }, "*");
          });

          devtoolProtocol.sendRawMessage(
            `{"id":5,"method":"Runtime.enable","params":{}}`
          );
        }        
      }

      (document.head || document.documentElement).prepend(script);
    })();
  }

  if (typeof __REACT_DEVTOOLS_GLOBAL_HOOK__ === "undefined") {
    let nextID = 0;
    let hook = (__REACT_DEVTOOLS_GLOBAL_HOOK__ = {
      renderers: new Map(),
      supportsFiber: true,
      inject: (renderer) => {
        const id = nextID++;
        hook.renderers.set(id, renderer);
        return id;
      },
      onScheduleFiberRoot() {},
      onCommitFiberRoot() {},
      onCommitFiberUnmount() {},
    });
  }

  document.currentScript.remove();
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Imperium Ketchupu Heinz</title>
    <link rel="stylesheet" href="styles/style.css">
    <link rel="icon" href="skins/classic.png" type="image/png">
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-bottle"></div>
    </div>

    <header class="header">
        <h1 class="title" id="gameTitle" data-i18n="gameTitle">Imperium Ketchupu Heinz</h1>
        <button class="language-toggle" id="languageToggle" type="button">üåç PL</button>
    </header>

    <main class="game-container" id="gameContainer">
        <section class="stats-panel" aria-live="polite">
            <div class="glass-panel stat-item">
                <span class="stat-value" id="totalDrops">0</span>
                <div class="stat-label" id="dropsLabel" data-i18n="dropsLabel">Krople Ketchupu</div>
            </div>
            <div class="glass-panel stat-item">
                <span class="stat-value" id="dropsPerSecond">0</span>
                <div class="stat-label" id="dpsLabel" data-i18n="dpsLabel">Kropli na Sekundƒô</div>
            </div>
            <div class="glass-panel stat-item">
                <span class="stat-value" id="totalClicks">0</span>
                <div class="stat-label" id="clicksLabel" data-i18n="clicksLabel">Ca≈Çkowite Klikniƒôcia</div>
            </div>
            <div class="glass-panel stat-item">
                <span class="stat-value" id="rebirthCount">0</span>
                <div class="stat-label" id="rebirthLabel" data-i18n="rebirthLabel">Odrodzenia</div>
            </div>
            <div class="glass-panel stat-item">
                <span class="stat-value" id="soulPoints">0</span>
                <div class="stat-label" id="soulLabel" data-i18n="soulLabel">Punkty Duszy</div>
            </div>
        </section>

        <section class="clicker-area glass-panel" aria-label="Obszar gry">
            <div class="bottle-container">
                <img class="bottle" id="bottle" src="skins/classic.png" alt="Butelka ketchup Heinz">
            </div>
            <div class="skin-selector" id="skinSelector"></div>
            <div class="rebirth-panel">
                <button class="rebirth-button" id="rebirthButton" type="button" disabled>
                    <span id="rebirthText" data-i18n="rebirthText">Odrodzenie (wymagane 1e12 kropli)</span>
                </button>
                <div id="rebirthInfo"></div>
            </div>
        </section>

        <section class="upgrades-panel" id="sidePanel">
            <div class="glass-panel" style="text-align: center; margin-bottom: 10px;">
                <div class="tab-buttons" role="tablist">
                    <button class="tab-button active" id="upgradesTab" data-tab="upgrades" type="button" role="tab">
                        <span id="upgradesTitle" data-i18n="upgradesTitle">Ulepszenia</span>
                    </button>
                    <button class="tab-button" id="leaderboardTab" data-tab="leaderboard" type="button" role="tab">
                        <span id="leaderboardTitle" data-i18n="leaderboardTitle">Ranking</span>
                    </button>
                </div>
            </div>

            <div id="upgradesContainer" aria-live="polite"></div>

            <div id="leaderboardContainer" style="display: none;">
                <div class="glass-panel">
                    <div class="tab-buttons" id="leaderboardCategoryTabs">
                        <button class="tab-button active" data-category="totalDrops" id="totalDropsTab" type="button" data-i18n="totalDrops">Suma Kropli</button>
                        <button class="tab-button" data-category="rebirths" id="rebirthsTab" type="button" data-i18n="rebirths">Odrodzenia</button>
                        <button class="tab-button" data-category="maxDps" id="maxDpsTab" type="button" data-i18n="maxDps">Maks. DPS</button>
                        <button class="tab-button" data-category="playtime" id="playtimeTab" type="button" data-i18n="playtime">Czas Gry</button>
                    </div>
                    <p class="stat-label" id="leaderboardStatus"></p>
                    <button class="submit-score-btn" id="onlineToggleBtn" type="button">Funkcje online: W≈ÇƒÖczone</button>
                    <div id="leaderboardContent">
                        <table class="leaderboard-table">
                            <thead>
                                <tr>
                                    <th id="rankHeader" data-i18n="rank">Miejsce</th>
                                    <th id="playerHeader" data-i18n="player">Gracz</th>
                                    <th id="scoreHeader" data-i18n="score">Wynik</th>
                                </tr>
                            </thead>
                            <tbody id="leaderboardBody"></tbody>
                        </table>
                        <button class="submit-score-btn" id="submitScoreBtn" type="button" data-i18n="submitScore">Dodaj do Rankingu</button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <div class="achievement-popup" id="achievementPopup" role="status">
        <div class="achievement-title" id="achievementTitle" data-i18n="achievementUnlocked">OsiƒÖgniƒôcie Odblokowane!</div>
        <div class="achievement-desc" id="achievementDesc">Opis</div>
    </div>

    <div class="modal" id="rebirthModal" role="dialog" aria-modal="true" aria-labelledby="rebirthModalTitle">
        <div class="modal-content">
            <h2 id="rebirthModalTitle" data-i18n="rebirthModalTitle">Potwierdzenie Odrodzenia</h2>
            <p id="rebirthModalDesc" data-i18n="rebirthModalDesc">To zresetuje ca≈Çy postƒôp, ale da sta≈Çe bonusy!</p>
            <div id="rebirthBonusInfo"></div>
            <button class="rebirth-button" id="confirmRebirth" type="button" data-i18n="confirmRebirth">Potwierd≈∫ Odrodzenie</button>
            <button class="rebirth-button" id="cancelRebirth" type="button" data-i18n="cancel">Anuluj</button>
        </div>
    </div>

    <div class="modal" id="playerNameModal" role="dialog" aria-modal="true" aria-labelledby="playerNameModalTitle">
        <div class="modal-content">
            <h2 id="playerNameModalTitle" data-i18n="nicknameModalTitle">Wprowad≈∫ sw√≥j Nick</h2>
            <p id="playerNameModalDesc" data-i18n="nicknameModalDesc">Ta nazwa bƒôdzie u≈ºywana w rankingu. Mo≈ºesz jƒÖ ustawiƒá tylko raz!</p>
            <input type="text" class="player-name-input" id="initialPlayerNameInput" placeholder="Tw√≥j nick..." maxlength="20">
            <button class="submit-score-btn" id="savePlayerNameBtn" type="button" data-i18n="saveNickname">Zapisz Nick</button>
        </div>
    </div>

    <audio id="clickSound" preload="auto">
        <source src="sounds/squish.mp3" type="audio/mpeg">
    </audio>
    <audio id="upgradeSound" preload="auto">
        <source src="sounds/upgrade.mp3" type="audio/mpeg">
    </audio>
    <audio id="achievementSound" preload="auto">
        <source src="sounds/victory.mp3" type="audio/mpeg">
    </audio>
    <audio id="rebirthSound" preload="auto">
        <source src="sounds/rebirth.mp3" type="audio/mpeg">
    </audio>

    <script src="env.js"></script>
    <script type="module" src="src/main.js"></script>
</body>
</html>
